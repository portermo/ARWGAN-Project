# COCO 2017 資料集下載說明

## 概述

ARWGAN 訓練需要圖片資料集，本專案使用 COCO 2017 資料集。資料集需要組織成 ImageFolder 格式，即 `train/` 和 `val/` 目錄結構。

## 快速開始

### 方法 1: 使用自動下載腳本（推薦）

```bash
# 啟動虛擬環境
cd /mnt/nvme/p3/Project/arwgan/ARWGAN-Project/ARWGAN-main
source venv/bin/activate

# 執行下載腳本
python download_coco_dataset.py
```

腳本會自動：
1. 下載 COCO 2017 資料集（使用 kagglehub）
2. 將資料集組織成 ImageFolder 格式
3. 創建 `data/coco2017/train/images/` 和 `data/coco2017/val/images/` 目錄

### 方法 2: 手動下載（使用 Python 腳本）

```python
import kagglehub

# 下載最新版本
path = kagglehub.dataset_download("awsaf49/coco-2017-dataset")

print("Path to dataset files:", path)
```

然後使用 `download_coco_dataset.py` 腳本組織資料集：

```bash
python download_coco_dataset.py --skip-download --dataset-path /path/to/downloaded/dataset
```

## 腳本選項

```bash
python download_coco_dataset.py [選項]

選項:
  -o, --output-dir DIR     輸出目錄（預設: data/coco2017）
  --max-train N           最大訓練圖片數量（用於測試）
  --max-val N             最大驗證圖片數量（用於測試）
  --skip-download         跳過下載步驟
  --dataset-path PATH      已下載資料集的路徑
```

### 範例

```bash
# 完整下載並組織資料集
python download_coco_dataset.py

# 指定輸出目錄
python download_coco_dataset.py -o data/my_coco

# 僅下載部分圖片用於測試（例如：1000 張訓練圖片，200 張驗證圖片）
python download_coco_dataset.py --max-train 1000 --max-val 200

# 使用已下載的資料集
python download_coco_dataset.py --skip-download --dataset-path /path/to/coco
```

## 資料集結構

下載並組織後，資料集結構如下：

```
data/coco2017/
├── train/
│   └── images/
│       ├── 000000000139.jpg
│       ├── 000000000285.jpg
│       └── ...
└── val/
    └── images/
        ├── 000000000632.jpg
        ├── 000000000724.jpg
        └── ...
```

## 使用資料集進行訓練

下載完成後，使用以下命令開始訓練：

```bash
source venv/bin/activate

python main.py new \
    -n my_experiment \
    -d data/coco2017 \
    -b 32 \
    -e 100 \
    -s 128 \
    -m 30
```

參數說明：
- `-n`: 實驗名稱
- `-d`: 資料集目錄（應包含 `train/` 和 `val/` 子目錄）
- `-b`: batch size
- `-e`: epoch 數量
- `-s`: 圖片大小（預設 128）
- `-m`: 浮水印長度（預設 30）

## Kaggle 認證

使用 kagglehub 下載資料集可能需要 Kaggle API 認證：

1. 登入 [Kaggle](https://www.kaggle.com/)
2. 前往 Account Settings → API
3. 下載 `kaggle.json` 檔案
4. 將檔案放置到 `~/.kaggle/kaggle.json`

或者設置環境變數：

```bash
export KAGGLE_USERNAME=your_username
export KAGGLE_KEY=your_api_key
```

## 注意事項

1. **儲存空間**: COCO 2017 資料集約 20GB，請確保有足夠的儲存空間
2. **下載時間**: 下載可能需要較長時間，取決於網路速度
3. **符號連結**: 腳本會嘗試使用符號連結以節省空間，如果不支援則會複製檔案
4. **圖片格式**: 支援 .jpg, .jpeg, .png, .bmp 格式

## 疑難排解

### 問題: Kaggle API 認證失敗

**解決方案**: 
```bash
# 檢查 kaggle.json 是否在正確位置
ls ~/.kaggle/kaggle.json

# 設置正確的權限
chmod 600 ~/.kaggle/kaggle.json
```

### 問題: 找不到 train2017 或 val2017 目錄

**解決方案**: 腳本會自動搜索資料集目錄。如果仍然找不到，請檢查下載的資料集結構，並使用 `--dataset-path` 指定正確的路徑。

### 問題: 磁碟空間不足

**解決方案**: 
- 使用符號連結（腳本會自動嘗試）
- 只下載部分圖片用於測試（使用 `--max-train` 和 `--max-val`）
- 清理不需要的檔案

### 問題: 下載速度慢

**解決方案**: 
- 確保網路連接穩定
- 考慮使用 Kaggle CLI 或其他下載方式
- 可以暫停下載並稍後繼續（kagglehub 支援斷點續傳）

## 相關檔案

- `download_coco_dataset.py`: 自動下載和組織資料集的腳本
- `requirements.txt`: 包含 kagglehub 依賴
- `環境設定說明.md`: 虛擬環境設定說明